<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ðŸ”¥ Rizz System Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    margin: 0;
    background: #000;
    color: #fff;
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    padding: 20px;
  }

  h1 { margin-bottom: 10px; }

  input, button {
    border-radius: 12px;
    border: none;
    padding: 12px;
    font-size: 16px;
  }

  input {
    width: 100%;
    margin-bottom: 10px;
  }

  button {
    background: #e5e5e5;
    margin: 5px 5px 5px 0;
  }

  .banner {
    background: orange;
    color: black;
    padding: 12px;
    border-radius: 12px;
    margin-bottom: 15px;
    font-weight: 600;
  }

  .card {
    margin-bottom: 30px;
  }

  .row {
    display: flex;
    flex-wrap: wrap;
  }

  .badge {
    background: #333;
    padding: 4px 10px;
    border-radius: 8px;
    margin-left: 8px;
    font-size: 14px;
  }

  .focus { background: #00ff99; color: black; }

  .bar {
    background: #333;
    border-radius: 10px;
    overflow: hidden;
    height: 14px;
    margin: 8px 0;
  }

  .fill {
    height: 100%;
    background: #00ff99;
  }
</style>
</head>

<body>

<h1>ðŸ”¥ Rizz System Dashboard</h1>
<div id="banner"></div>

<input id="nameInput" placeholder="Enter name (e.g. Charity)">
<button onclick="addOrUpdate()">Add / Update</button>

<div id="list"></div>

<script>
const MAX_FOCUS = 2;
const DECAY_DAYS = 2;
const STORAGE_KEY = "rizzSystemData";

let people = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(people));
}

function showBanner(msg) {
  const b = document.getElementById("banner");
  b.innerHTML = `<div class="banner">${msg}</div>`;
  setTimeout(() => b.innerHTML = "", 4000);
}

function addOrUpdate() {
  const name = document.getElementById("nameInput").value.trim();
  if (!name) return;

  let p = people.find(x => x.name === name);
  if (!p) {
    p = {
      name,
      score: 0,
      status: "active",
      updated: Date.now(),
      focusTime: null
    };
    people.push(p);
  }
  p.updated = Date.now();
  save();
  render();
}

function changeScore(p, delta) {
  p.score = Math.max(0, Math.min(100, p.score + delta));
  p.updated = Date.now();

  if (p.score >= 90 && p.status !== "focus") {
    p.status = "focus";
    p.focusTime = Date.now();
    showBanner("âš¡ Auto-Focus: reached 90%");
  }

  enforceFocusRules();
  save();
  render();
}

function setStatus(p, status) {
  p.status = status;
  p.updated = Date.now();
  if (status === "focus") p.focusTime = Date.now();
  enforceFocusRules();
  save();
  render();
}

function remove(p) {
  people = people.filter(x => x !== p);
  save();
  render();
}

function enforceFocusRules() {
  let focused = people.filter(p => p.status === "focus");

  focused.sort((a, b) => {
    if (a.score !== b.score) return a.score - b.score;
    return a.focusTime - b.focusTime;
  });

  while (focused.length > MAX_FOCUS) {
    const demoted = focused.shift();
    demoted.status = "active";
    demoted.focusTime = null;
    showBanner("âš  Focus limit reached â€” lowest priority focus removed");
  }
}

function applyDecay() {
  const now = Date.now();
  people.forEach(p => {
    const days = (now - p.updated) / (1000 * 60 * 60 * 24);
    if (days >= DECAY_DAYS && p.score > 0) {
      p.score = Math.max(0, p.score - 5);
      p.updated = now;
    }
  });
}

function render() {
  applyDecay();
  const list = document.getElementById("list");
  list.innerHTML = "";

  people.forEach(p => {
    const div = document.createElement("div");
    div.className = "card";

    div.innerHTML = `
      <strong>${p.name} â€” ${p.score}%</strong>
      <span class="badge ${p.status === "focus" ? "focus" : ""}">
        ${p.status.toUpperCase()}
      </span>

      <div class="bar">
        <div class="fill" style="width:${p.score}%"></div>
      </div>

      <div class="row">
        <button onclick="changeScore(people[${people.indexOf(p)}], -10)">-10</button>
        <button onclick="changeScore(people[${people.indexOf(p)}], 10)">+10</button>
        <button onclick="setStatus(people[${people.indexOf(p)}], 'focus')">Focus</button>
        <button onclick="setStatus(people[${people.indexOf(p)}], 'active')">Active</button>
        <button onclick="remove(people[${people.indexOf(p)}])">Delete</button>
      </div>
    `;

    list.appendChild(div);
  });
}

render();
</script>

</body>
</html>